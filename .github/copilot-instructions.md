# Copilot Instructions for omnistrate-sdk-go

## What This Project Is

This is an **auto-generated** Go SDK for the Omnistrate platform APIs. All code under `v1/` and `fleet/` is generated by [OpenAPI Generator](https://openapi-generator.tech) from Omnistrate's OpenAPI specs — **do not edit these files manually**.

## Project Layout

- `v1/` — Generated Go client for Omnistrate Service Registration, Build, and Consumption APIs.
- `fleet/` — Generated Go client for Omnistrate Fleet APIs (host clusters, operations, inventory, webhooks, etc.).
- `templates/go/` — Custom Mustache templates used by OpenAPI Generator to produce Go code. Modify these to change generated output.
- `src/` — OpenAPI Generator meta scaffolding (default boilerplate, not actively used for generation).
- `Makefile` — Orchestrates code generation, validation, and build.
- `.github/workflows/build.yml` — CI pipeline: builds on PRs and pushes to `main`, auto-tags releases on merge.

## Code Generation Pipeline

The SDK is regenerated from remote OpenAPI specs:

1. **v1 spec**: `https://api.omnistrate.cloud/2022-09-01-00/openapi.yaml`
2. **Fleet spec**: `https://api.omnistrate.cloud/2022-09-01-00/fleet/openapi.yaml`

Run `make all` to clean, regenerate both packages, tidy dependencies, and build.
Run `make gen-go-sdk` or `make gen-fleet-go-sdk` individually.

Key generator options used:
- `packageName=v1` / `packageName=fleet`
- `withGoMod=false, isGoSubmodule=true` — packages live within the parent module
- `generateInterfaces=true` — API interfaces are generated for testability
- `disallowAdditionalPropertiesIfNotPresent=false` — flexible model handling
- `structPrefix=false` — no struct name prefixes
- Custom templates from `templates/go/` override default OpenAPI Generator templates

## How to Make Changes

### To change generated code patterns or templates
Edit files in `templates/go/` (Mustache templates), then run `make all` to regenerate.

### To update the SDK to a newer API version
Run `make all` (or `make clean && make gen-go-sdk && make gen-fleet-go-sdk && make tidy && make build`). The specs are fetched from remote URLs. You can override with:
```sh
make all OPEN_API_SPEC=path/to/spec.yaml FLEET_OPEN_API_SPEC=path/to/fleet-spec.yaml
```

### To add non-generated code
Place it outside `v1/` and `fleet/` since those directories are wiped on `make clean`.

## Build & Test

- **Build**: `make build` (runs `go build -v ./...`)
- **Dependencies**: `make download` or `make tidy`
- **Validate specs**: `make validate`
- Go version is specified in `go.mod` and `.go-version`

## Architecture Notes

- Both `v1` and `fleet` packages follow the same structure: `client.go` (APIClient), `configuration.go` (server URLs, auth), `api_*.go` (one file per API group), `model_*.go` (one file per model), and `docs/` for generated documentation.
- Authentication is handled via Go context values (`ContextAccessToken`, `ContextBasicAuth`).
- The default server URL is `https://api.omnistrate.cloud`.
- `.openapi-generator-ignore` prevents regeneration of `go.mod`, `go.sum`, and `LICENSE`.
- The CI workflow auto-tags a new semver version on every push to `main`.

## Common Pitfalls

- **Never manually edit files in `v1/` or `fleet/`** — they will be overwritten on the next generation run.
- The `src/` directory contains a Java-based OpenAPI Generator meta scaffold with placeholder logic — it is not used for actual SDK generation.
- The `templates/go/` directory is the correct place to customize generated output.
